<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<title>Feature Style</title>
</head>
<body>

	<h3>Extension Title</h3>
	<p>Feature Style</p>

	<h3>Introduction</h3>
	<p>This extension defines styles and icons for feature geometries.  Feature tables may assigned default styles and features may be individually styled.  Styles may be assigned as geometry type specific.</p>
	<p>This extension depends on the <a href="http://www.geopackage.org/18-000.html">OGC GeoPackage Related Tables Extension</a>.</p>
	<p>This extension depends on the <a href="http://ngageoint.github.io/GeoPackage/docs/extensions/contents-id.html">NGA Contents Id Extension</a> for default style configurations.</p>

		<h3>Extension Author</h3>
		<p>National Geospatial-Intelligence Agency, author_name <code>nga</code></p>

		<h3>Extension Name or Template</h3>
		<p><code>nga_feature_style</code></p>

		<h3>Extension Type</h3>
		<p>New Requirement</p>

		<h3>Applicability</h3>
		<p>This extension applies to the table names of feature user tables (<a href="http://www.geopackage.org/spec/#feature_user_tables">2.1.6</a>).</p>

		<h3>Scope</h3>
		<p>Read-write</p>

		<h3>Requirements</h3>

		<h4>GeoPackage</h4>

		<img src="FeatureStyle.png" alt="Feature Style">

		<h5>Extension Table Entries</h5>

		<p>The Feature Style extension is registered into the <code>gpkg_extensions</code> table once per feature table.
			Each <a href="http://www.geopackage.org/18-000.html#user_defined_mapping_table">user-defined mapping table</a> between a feature or table and a style or icon is registered per the <a href="http://www.geopackage.org/18-000.html#_gpkg_extensions">Related Tables Extension</a>.</p>
		<p><code><i>&lt;feature_table_name&gt;</i></code> = name of a feature table</p>

		<table border="1">
			<caption><code>gpkg_extensions entries</code></caption>
			<thead>
				<tr>
					<th>table_name</th>
					<th>column_name</th>
					<th>extension_name</th>
					<th>definition</th>
					<th>scope</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td><p><code><i>&lt;feature_table_name&gt;</i></code></p></td>
					<td><p>null</p></td>
					<td><p><code>nga_feature_style</code></p></td>
					<td><p>URL to this extension description</p></td>
					<td><p>read-write</p></td>
				</tr>
				<tr>
					<td><p><code>nga_style_<i>&lt;feature_table_name&gt;</i></code></p></td>
					<td><p>null</p></td>
					<td><p><code>related_tables</code></p></td>
					<td><p>http://www.geopackage.org/18-000.html</p></td>
					<td><p>read-write</p></td>
				</tr>
				<tr>
					<td><p><code>nga_icon_<i>&lt;feature_table_name&gt;</i></code></p></td>
					<td><p>null</p></td>
					<td><p><code>related_tables</code></p></td>
					<td><p>http://www.geopackage.org/18-000.html</p></td>
					<td><p>read-write</p></td>
				</tr>
				<tr>
					<td><p><code>nga_style_default_<i>&lt;feature_table_name&gt;</i></code></p></td>
					<td><p>null</p></td>
					<td><p><code>related_tables</code></p></td>
					<td><p>http://www.geopackage.org/18-000.html</p></td>
					<td><p>read-write</p></td>
				</tr>
				<tr>
					<td><p><code>nga_icon_default_<i>&lt;feature_table_name&gt;</i></code></p></td>
					<td><p>null</p></td>
					<td><p><code>related_tables</code></p></td>
					<td><p>http://www.geopackage.org/18-000.html</p></td>
					<td><p>read-write</p></td>
				</tr>
			</tbody>
		</table>

		<h5>Contents Entries</h5>

		<p>The Feature Style extension <code>nga_style</code> and <code>nga_icon</code> tables are listed as attribute contents tables alongside feature tables.</p>

		<table border="1">
			<caption><code>gpkg_contents entries</code></caption>
			<thead>
				<tr>
					<th>table_name</th>
					<th>data_type</th>
					<th>identifier</th>
					<th>description</th>
					<th>last_change</th>
					<th>min_x</th>
					<th>min_y</th>
					<th>max_x</th>
					<th>max_y</th>
					<th>srs_id</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td><p><code><i>&lt;feature_table_name&gt;</i></code></p></td>
					<td><p>features</p></td>
					<td><p><i>any</i></p></td>
					<td><p><i>any</i></p></td>
					<td><p><i>any</i></p></td>
					<td><p><i>any</i></p></td>
					<td><p><i>any</i></p></td>
					<td><p><i>any</i></p></td>
					<td><p><i>any</i></p></td>
					<td><p><i>any</i></p></td>
				</tr>
				<tr>
					<td><p><code>nga_style</code></p></td>
					<td><p>attributes</p></td>
					<td><p><i>any</i></p></td>
					<td><p><i>any</i></p></td>
					<td><p><i>any</i></p></td>
					<td><p>null</p></td>
					<td><p>null</p></td>
					<td><p>null</p></td>
					<td><p>null</p></td>
					<td><p>null</p></td>
				</tr>
				<tr>
					<td><p><code>nga_icon</code></p></td>
					<td><p>attributes</p></td>
					<td><p><i>any</i></p></td>
					<td><p><i>any</i></p></td>
					<td><p><i>any</i></p></td>
					<td><p>null</p></td>
					<td><p>null</p></td>
					<td><p>null</p></td>
					<td><p>null</p></td>
					<td><p>null</p></td>
				</tr>
			</tbody>
		</table>

		<h5>Style Table</h5>

		<p>The Style Table defines a geometry style and is an <a href="http://www.geopackage.org/spec121/#attributes">Attributes Table</a>.</p>

			<table border="1">
				<caption><code>nga_style</code></caption>
				<thead>
					<tr>
						<th>Column Name</th>
						<th>Type</th>
						<th>Description</th>
						<th>Null</th>
						<th>Default</th>
						<th>Key</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td><p><code>id</code></p></td>
						<td><p>INTEGER</p></td>
						<td><p>Autoincrement primary key</p></td>
						<td><p>no</p></td>
						<td></td>
						<td><p>PK</p></td>
					</tr>
					<tr>
						<td><p><code>name</code></p></td>
						<td><p>TEXT</p></td>
						<td><p>Feature Style name</p></td>
						<td><p>yes</p></td>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td><p><code>description</code></p></td>
						<td><p>TEXT</p></td>
						<td><p>Feature Style description</p></td>
						<td><p>yes</p></td>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td><p><code>color</code></p></td>
						<td><p>TEXT</p></td>
						<td><p>Geometry color in hex format <code>#RRGGBB</code> or <code>#RGB</code>, when null assume #000000</p></td>
						<td><p>yes</p></td>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td><p><code>opacity</code></p></td>
						<td><p>REAL</p></td>
						<td><p>Geometry color opacity inclusively between 0.0 and 1.0, when null assume 1.0</p></td>
						<td><p>yes</p></td>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td><p><code>width</code></p></td>
						<td><p>REAL</p></td>
						<td><p>Geometry line stroke or point width >= 0.0, when null assume 1.0</p></td>
						<td><p>yes</p></td>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td><p><code>fill_color</code></p></td>
						<td><p>TEXT</p></td>
						<td><p>Closed geometry fill color in hex format <code>#RRGGBB</code> or <code>#RGB, no fill when null</code></p></td>
						<td><p>yes</p></td>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td><p><code>fill_opacity</code></p></td>
						<td><p>REAL</p></td>
						<td><p>Closed geometry fill color opacity inclusively between 0.0 and 1.0, when null assume 1.0</p></td>
						<td><p>yes</p></td>
						<td></td>
						<td></td>
					</tr>
				</tbody>
			</table>

			<pre><code>
CREATE TABLE nga_style (
  id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL,
  name TEXT,
  description TEXT,
  color TEXT,
  opacity REAL,
  width REAL,
  fill_color TEXT,
  fill_opacity REAL
);</code></pre>

		<h5>Icon Table</h5>

		<p>The Icon Table defines a geometry icon or marker and is a Related Tables Extension <a href="http://www.geopackage.org/18-000.html#media_rc">Media Table</a>.</p>

			<table border="1">
				<caption><code>nga_icon</code></caption>
				<thead>
					<tr>
						<th>Column Name</th>
						<th>Type</th>
						<th>Description</th>
						<th>Null</th>
						<th>Default</th>
						<th>Key</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td><p><code>id</code></p></td>
						<td><p>INTEGER</p></td>
						<td><p>Autoincrement primary key</p></td>
						<td><p>no</p></td>
						<td></td>
						<td><p>PK</p></td>
					</tr>
					<tr>
						<td><p><code>data</code></p></td>
						<td><p>BLOB</p></td>
						<td><p>Feature Icon content</p></td>
						<td><p>no</p></td>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td><p><code>content_type</code></p></td>
						<td><p>TEXT</p></td>
						<td><p>Mime-type of the feature icon</p></td>
						<td><p>no</p></td>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td><p><code>name</code></p></td>
						<td><p>TEXT</p></td>
						<td><p>Feature Icon name</p></td>
						<td><p>yes</p></td>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td><p><code>description</code></p></td>
						<td><p>TEXT</p></td>
						<td><p>Feature Icon description</p></td>
						<td><p>yes</p></td>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td><p><code>width</code></p></td>
						<td><p>REAL</p></td>
						<td><p>Icon display width. When null and height has value, maintain aspect ratio. When null and height is null, use data icon width.</p></td>
						<td><p>yes</p></td>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td><p><code>height</code></p></td>
						<td><p>REAL</p></td>
						<td><p>Icon display height. When null and width has value, maintain aspect ratio. When null and width is null, use data icon height.</p></td>
						<td><p>yes</p></td>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td><p><code>anchor_u</code></p></td>
						<td><p>REAL</p></td>
						<td><p>UV Mapping horizontal anchor distance inclusively between 0.0 and 1.0 from the left edge, when null assume 0.5 (middle of icon)</p></td>
						<td><p>yes</p></td>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td><p><code>anchor_v</code></p></td>
						<td><p>REAL</p></td>
						<td><p>UV Mapping vertical anchor distance inclusively between 0.0 and 1.0 from the top edge, when null assume 1.0 (bottom of icon)</p></td>
						<td><p>yes</p></td>
						<td></td>
						<td></td>
					</tr>
				</tbody>
			</table>

			<pre><code>
CREATE TABLE nga_icon (
  id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL,
  data BLOB NOT NULL,
  content_type TEXT NOT NULL,
  name TEXT,
  description TEXT,
  width REAL,
  height REAL,
  anchor_u REAL,
  anchor_v REAL
);</code></pre>

		<h5>Contents Id</h5>

		<p>The <a href="http://ngageoint.github.io/GeoPackage/docs/extensions/contents-id.html">Contents Id Extension</a> is used to relate default styles to a feature table by an <code>INTEGER</code> primary key, as required by the Related Tables Extension <a href="http://www.geopackage.org/18-000.html#user_defined_mapping_table">User-Defined Mapping Tables</a>.</p>

		<table border="1">
			<caption><code>nga_contents_id entries</code></caption>
			<thead>
				<tr>
					<th>id</th>
					<th>table_name</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td><p><i>any</i></p></td>
					<td><p><code><i>&lt;feature_table_name&gt;</i></code></p></td>
				</tr>
			</tbody>
		</table>

		<h5>Mapping Tables</h5>

		<p>Related Tables Extension <a href="http://www.geopackage.org/18-000.html#user_defined_mapping_table">Mapping Tables</a> are used to relate:</p>

		<ul>
  		<li>Feature Tables to Default Styles - <code>nga_style_default_<i>&lt;feature_table_name&gt;</i></code></li>
  		<li>Feature Tables to Default Icons - <code>nga_icon_default_<i>&lt;feature_table_name&gt;</i></code></li>
  		<li>Features to Styles - <code>nga_style_<i>&lt;feature_table_name&gt;</i></code></li>
  		<li>Features to Icons - <code>nga_icon_<i>&lt;feature_table_name&gt;</i></code></li>
		</ul>

		<p>The Mapping Tables are defined in the Related Tables Extension <a href="http://www.geopackage.org/18-000.html#_gpkgext_relations">Relations Table:</a></p>

		<table border="1">
			<caption><code>gpkgext_relations entries</code></caption>
			<thead>
				<tr>
					<th>id</th>
					<th>base_table_name</th>
					<th>base_primary_column</th>
					<th>related_table_name</th>
					<th>related_primary_column</th>
					<th>relation_name</th>
					<th>mapping_table_name</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td><p><i>any</i></p></td>
					<td><p><code>nga_contents_id</code></p></td>
					<td><p><code>id</code></p></td>
					<td><p><code>nga_style</code></p></td>
					<td><p><code>id</code></p></td>
					<td><p>attributes</p></td>
					<td><p><code>nga_style_default_<i>&lt;feature_table_name&gt;</i></code></p></td>
				</tr>
				<tr>
					<td><p><i>any</i></p></td>
					<td><p><code>nga_contents_id</code></p></td>
					<td><p><code>id</code></p></td>
					<td><p><code>nga_icon</code></p></td>
					<td><p><code>id</code></p></td>
					<td><p>media</p></td>
					<td><p><code>nga_icon_default_<i>&lt;feature_table_name&gt;</i></code></p></td>
				</tr>
				<tr>
					<td><p><i>any</i></p></td>
					<td><p><code><i>&lt;feature_table_name&gt;</i></code></p></td>
					<td><p><code>id</code></p></td>
					<td><p><code>nga_style</code></p></td>
					<td><p><code>id</code></p></td>
					<td><p>attributes</p></td>
					<td><p><code>nga_style_<i>&lt;feature_table_name&gt;</i></code></p></td>
				</tr>
				<tr>
					<td><p><i>any</i></p></td>
					<td><p><code><i>&lt;feature_table_name&gt;</i></code></p></td>
					<td><p><code>id</code></p></td>
					<td><p><code>nga_icon</code></p></td>
					<td><p><code>id</code></p></td>
					<td><p>media</p></td>
					<td><p><code>nga_icon_<i>&lt;feature_table_name&gt;</i></code></p></td>
				</tr>
			</tbody>
		</table>

		<p>Style and Icon <a href="http://www.geopackage.org/18-000.html#user_defined_mapping_table">Mapping Tables</a> contain the id mapping columns and a nullable geometry_type_name.</p>

			<table border="1">
				<caption><code>nga_style_default_<i>&lt;feature_table_name&gt;</i>, nga_icon_default_<i>&lt;feature_table_name&gt;</i>, nga_style_<i>&lt;feature_table_name&gt;</i>, nga_icon_<i>&lt;feature_table_name&gt;</i></code></caption>
				<thead>
					<tr>
						<th>Column Name</th>
						<th>Type</th>
						<th>Description</th>
						<th>Null</th>
						<th>Default</th>
						<th>Key</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td><p><code>base_id</code></p></td>
						<td><p>INTEGER</p></td>
						<td><p>The primary key value of the base data table (<code>nga_contents_id</code> or <code><i>&lt;feature_table_name&gt;</i></code>)</p></td>
						<td><p>no</p></td>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td><p><code>related_id</code></p></td>
						<td><p>INTEGER</p></td>
						<td><p>The primary key value of the related data table (<code>nga_style</code> or <code>nga_icon</code>)</p></td>
						<td><p>no</p></td>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td><p><code>geometry_type_name</code></p></td>
						<td><p>TEXT</p></td>
						<td><p>Name from <a href="http://www.geopackage.org/spec121/#geometry_types_core">Geometry Type Codes (Core)</a> or <a href="http://www.geopackage.org/spec121/#geometry_types_extension">Geometry Type Codes (Extension)</a> in <a href="http://www.geopackage.org/spec121/#geometry_types">Geometry Types (Normative)</a></p>
						<p>A null value configures a top level or default geometry style or icon.</p>
						<p>A defined geometry type maps the style or icon for geometries of that and inherited geometry types. The lowest configured feature matching geometry type takes priority.</p>
						<p><a href="http://www.geopackage.org/18-000.html#user_defined_mapping_table">User-Defined Mapping Table</a> unique constraints are discouraged, but duplicate <code>base_id</code>, <code>related_id</code>, and <code>geometry_type_name</code> triplets are discouraged as conflicting styling may be unpredictable.</p></td>
						<td><p>yes</p></td>
						<td></td>
						<td></td>
					</tr>
				</tbody>
			</table>

			<pre><code>
CREATE TABLE nga_[style_default|icon_default|style|icon]_<i>&lt;feature_table_name&gt;</i> (
  base_id INTEGER NOT NULL,
  related_id INTEGER NOT NULL,
  geometry_type_name TEXT
);</code></pre>

				<h4>GeoPackage SQLite Configuration</h4>
				<p>None</p>

				<h4>GeoPackage SQLite Extension</h4>
				<p>None</p>

				<h4>Examples</h4>
				<p>The <a href="../../examples/rivers.gpkg">rivers</a> GeoPackage has a default style for the <code>rivers</code> feature table.</p>
				<p>The <a href="../../examples/java/example.gpkg">example</a> GeoPackage has styles and icons for the <code>geometry1</code> and <code>geometry2</code> feature tables.</p>

			</body>
			</html>
